/* uSlide
 * Copyright (c) 2012-2013 Dominik Marczuk
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * The name of Dominik Marczuk may not be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY DOMINIK MARCZUK "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL DOMINIK MARCZUK BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
(function(e){var t=function(t,n){n=e.extend({animation:"slide",delay:2e3,easing:"swing",framerate:50,speed:500,nextFadeInAnimation:null,nextFadeInDirection:"right",nextFadeInEasing:null,nextFadeInSpeed:null,nextFadeOutAnimation:null,nextFadeOutDirection:"left",nextFadeOutEasing:null,nextFadeOutSpeed:null,prevFadeInAnimation:null,prevFadeInDirection:"left",prevFadeInEasing:null,prevFadeInSpeed:null,prevFadeOutAnimation:null,prevFadeOutDirection:"right",prevFadeOutEasing:null,prevFadeOutSpeed:null,customCss:false,css:{current:null,nextFadeIn:null,nextFadeOut:null,prevFadeIn:null,prevFadeOut:null},customAnimate:false,animate:{nextFadeIn:null,nextFadeOut:null,prevFadeIn:null,prevFadeOut:null},autoStart:true,pauseOnHover:true,swipe:"ontouchend"in document,navigator:".navigator",next:".next",prev:".prev",progress:".progress",slider:".slider"},n);if(n.css.current!=null&&n.css.nextFadeIn!=null&&n.css.nextFadeOut!=null&&n.css.prevFadeIn!=null&&n.css.prevFadeOut!=null){n.customCss=true;n.customAnimate=false}else if(n.animate.nextFadeIn!=null&&n.animate.nextFadeOut!=null&&n.animate.prevFadeIn!=null&&n.animate.prevFadeOut!=null){n.customCss=false;n.customAnimate=true}else{n.customCss=false;n.customAnimate=false}var r=this,i=0,s=[],o=[],u=[],a=false,f=0,l=0,c=t.find(n.prev),h=t.find(n.next),p=t.find(n.navigator),d=t.find(n.progress),v=false;var m=function(r,i){var s={};if(null===r){r=n.animation}r=r.split(" ");i=i.split(" ");if(e.inArray("fade",r)>-1){s.opacity=0}else{s.opacity=1}if(e.inArray("slide",r)>-1){if(e.inArray("top",i)>-1){s.top=-t.innerHeight()+"px"}if(e.inArray("bottom",i)>-1){s.top=t.innerHeight()+"px"}if(e.inArray("left",i)>-1){s.left=-t.innerWidth()+"px"}if(e.inArray("right",i)>-1){s.left=t.innerWidth()+"px"}}else{s.top=0;s.left=0}return s};var g=function(){return(new Date).getTime()};var y=function(){p.find(".item").removeClass("active");p.find(".item:nth-child("+(i+1)+")").addClass("active")};this.getCurrentSlide=function(){return s[i]};this.getIndex=function(){return i};this.getSlideCount=function(){return s.length};this.getNextSlide=function(){return s[(i+1)%s.length]};this.getPreviousSlide=function(){return s[(i+s.length-1)%s.length]};this.getSlide=function(e){return s[e]};this.getSlideRelative=function(e){while(i+e<0){e+=s.length}return s[(i+e)%s.length]};this.next=function(t){if(typeof t!="number"){t=i+1}while(t<0){t+=s.length}t%=s.length;if(t==i){return false}f=0;var o=s[t].stop(true,false);var u=s[i].stop(true,false);if(n.customAnimate){n.animate.nextFadeIn(o);n.animate.nextFadeOut(u)}else{var a,l;if(n.customCss){o.css(n.css.nextFadeIn);a=n.css.current;u.css(n.css.current);l=n.css.nextFadeOut}else{o.css(m(n.nextFadeInAnimation,n.nextFadeInDirection));a={top:0,left:0,opacity:1};u.css(a);l=m(n.nextFadeOutAnimation,n.nextFadeOutDirection)}var c=n.nextFadeInSpeed!=null?n.nextFadeInSpeed:n.speed;var h=n.nextFadeOutSpeed!=null?n.nextFadeOutSpeed:n.speed;var p=n.nextFadeInEasing!=null?n.nextFadeInEasing:n.easing;var d=n.nextFadeOutEasing!=null?n.nextFadeOutEasing:n.easing;o.trigger("uSlide.nextFadeInStart",[r]);u.trigger("uSlide.nextFadeOutStart",[r]);if("transition"in e.fn&&n.customCss){o.show().transition(a,c,p,function(){o.trigger("uSlide.nextFadeInEnd",[this])});u.transition(l,h,d,function(){u.hide().trigger("uSlide.nextFadeOutEnd",[this])})}else{o.show().animate(a,c,p,function(){o.trigger("uSlide.nextFadeInEnd",[this])});u.animate(l,h,d,function(){u.hide().trigger("uSlide.nextFadeOutEnd",[this])})}}i=t;y();return false};this.previous=function(t){if(typeof t!="number"){t=i-1}while(t<=0){t+=s.length}t%=s.length;if(t==i){return false}f=0;var o=s[t].stop(true,false);var u=s[i].stop(true,false);if(n.customAnimate){n.animate.prevFadeOut(u);n.animate.prevFadeIn(o)}else{var a,l;if(n.customCss){o.css(n.css.prevFadeIn);a=n.css.current;u.css(n.css.current);l=n.css.prevFadeOut}else{o.css(m(n.prevFadeInAnimation,n.prevFadeInDirection));a={top:0,left:0,opacity:1};u.css({top:0,left:0,opacity:1});l=m(n.prevFadeOutAnimation,n.prevFadeOutDirection)}var c=n.prevFadeInSpeed!=null?n.prevFadeInSpeed:n.speed;var h=n.prevFadeOutSpeed!=null?n.prevFadeOutSpeed:n.speed;var p=n.prevFadeInEasing!=null?n.prevFadeInEasing:n.easing;var d=n.prevFadeOutEasing!=null?n.prevFadeOutEasing:n.easing;o.trigger("uSlide.prevFadeInStart",[r]);u.trigger("uSlide.prevFadeOutStart",[r]);if("transition"in e.fn&&n.customCss){o.show().transition(a,c,p,function(){o.trigger("uSlide.prevFadeInEnd",[this])});u.transition(l,h,d,function(){u.hide().trigger("uSlide.prevFadeOutEnd",[this])})}else{o.show().animate(a,c,p,function(){o.trigger("uSlide.prevFadeInEnd",[this])});u.animate(l,h,d,function(){u.hide().trigger("uSlide.prevFadeOutEnd",[this])})}}i=t;y();return false};this.slideTo=function(e,t){if(typeof e!="number"){throw"SlideTo expects a number parametre."}while(e<0){e+=s.length}e%=s.length;if(t=="next"){r.next(e)}else if(t=="previous"||t=="prev"){r.previous(e)}else{if(e>i){r.next(e)}else if(e<i){r.previous(e)}}};this.play=function(){a=true;l=g();setTimeout(function(){if(n.pauseOnHover&&v){f=0}else{f+=g()-l}if(f>=n.delay){r.next()}if(a){r.play()}},n.framerate)};this.stop=function(){a=false;f=0};this.pause=function(){a=false};this.getProgress=function(){return f/n.delay};t.find(n.slider).css({position:"relative"}).children().each(function(t,n){e(n).css({position:"absolute"});s.push(e(n));o.push(e(n).attr("style"))}).bind({mouseenter:function(){v=true},mouseleave:function(){v=false}});if(n.swipe){var b="ontouchend"in document;var w=b?"touchstart":"mousedown";var E=b?"touchmove":"mousemove";var S=b?"touchend":"mouseup";var x=1e3,T=50;var N=0,C=0;t.bind(w,function(e){e.preventDefault();C=e.timeStamp;N=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX}).bind(S,function(){C=0;N=0}).bind(E,function(e){e.preventDefault();var t=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX;var n=N?Math.abs(t-N):0;var i=e.timeStamp-C;if(C&&i<=x&&n>=T){if(t<N){r.next()}else if(t>N){r.previous()}C=0;N=0}})}for(var k=1;k<s.length;++k){if(n.customCss){s[k].css(n.css.nextFadeOut)}else{s[k].css(m(n.nextFadeOutAnimation,n.nextFadeOutDirection))}}if(c.length>0){for(k=0;k<c.length;++k){c[k].onclick=r.previous}}if(h.length>0){for(k=0;k<h.length;++k){h[k].onclick=r.next}}if(p.length>0){for(k=0;k<s.length;++k){var L=e('<a href="#" class="item" rel="'+k+'">'+(k+1)+"</a>");L.bind({click:function(e){e.preventDefault();r.slideTo(parseInt(this.rel))}});u.push(L)}u[0].addClass("active");for(var A=0;A<u.length;++A){p.append(u[A])}}if(d.length>0){setInterval(function(){d.each(function(){e(this).css({width:r.getProgress()*100+"%"})})},n.framerate)}if(n.autoStart){this.play()}};e.fn.extend({uSlide:function(){var n=arguments;this.each(function(){if(e(this).data("uSlide")==null){e(this).data("uSlide",new t(e(this),n.length&&typeof n[0]=="object"?n[0]:{}))}});return this.data("uSlide")}})})(jQuery)
 